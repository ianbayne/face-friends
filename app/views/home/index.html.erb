<%= link_to('Logout', destroy_user_session_path, method: :delete) %>

<h1>Posts</h1>

<%= form_for @post, url: posts_path do |f| %>
  <%= f.hidden_field :image, value: @post.cached_image_data %>
  <%= f.file_field :image %>
  <%= f.text_area :body %>
  <%= f.submit %>
<% end %>

<% @posts.each do |post| %>
  <div>
    <%= link_to post_path(post) do %>
      <p><%= "#{post.user.full_name}" %> posted on <%= post.date_created_at %> at <%= post.time_created_at %>:</p>

      <%= image_tag post.image_url unless post.image_data.nil? %>

      <p><%= post.body %></p>
    <% end %>

    <% if post.user == current_user %>
      <%= link_to(
            'Delete post',
            post_path(post),
            method: :delete,
            data: {confirm: "Are you sure?"}
          )
      %>
    <% else %>
      <% if post.likes.where(user: current_user).present? %>
        <%= link_to(
              'Unlike post',
              post_like_path(
                id: post.likes.find_by(user: current_user).id,
                post_id: post.id
              ),
              method: :delete
            )
        %>
      <% else %>
        <%= link_to(
              'Like post',
              post_likes_path(post),
              method: :post
            )
        %>
      <% end %>
    <% end %>
  </div>
<% end %>

